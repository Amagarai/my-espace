<ion-content [fullscreen]="true" class="home-content ion-padding" #content (ionScroll)="onScroll($event)" (ionScrollEnd)="onScrollEnd($event)">
  <!-- Header Section -->
  <div class="header-card" [class.collapsed]="isScrolledDown" [style.opacity]="scrollOpacity">
    <div class="header-left">
      <div class="leaf-icon">
        <ion-icon name="logo"></ion-icon>
      </div>
      <div class="greeting">
        <h1>Bonjour {{ studentName }}</h1>
        <p>{{ todayDate }}</p>
      </div>
    </div>
    <div class="header-right">
      <div class="notification-icon" (click)="goToNotifications()">
        <ion-icon name="notifications-outline"></ion-icon>
      </div>
      <div class="profile-picture">
        <span class="profile-initials">{{ studentInitials }}</span>
      </div>
    </div>
  </div>

  <!-- Announcements Section -->
  <div class="announcements-section">
    @if (isLoadingAlertes) {
      <div class="loading-skeleton">
        <div class="skeleton-card"></div>
      </div>
    } @else if (alertes.length > 0) {
      <div class="announcements-swiper"
           (touchstart)="onSwipeStart($event)"
           (touchmove)="onSwipeMove($event)"
           (touchend)="onSwipeEnd()">
        <div class="announcements-track" [style.transform]="'translateX(-' + (currentAlerteIndex * 100) + '%)'">
          @for (alerte of alertes; track alerte.localId) {
            <div class="announcement-card" [class]="getAlerteTypeClass(alerte.annonceType)">
              <div class="announcement-icon" [class]="getAlerteIconClass(alerte.annonceType)">
                <ion-icon [name]="getAlerteIcon(alerte.annonceType)"></ion-icon>
              </div>
              <div class="announcement-content">
                <h4>{{ alerte.annonceTitre || alerte.title }}</h4>
                <p>{{ alerte.annonceContenu || alerte.description }}</p>
                <span class="announcement-type">{{ alerte.annonceType || 'Info' }}</span>
              </div>
            </div>
          }
        </div>
        @if (alertes.length > 1) {
          <div class="announcements-indicators">
            @for (alerte of alertes; track alerte.localId; let i = $index) {
              <span class="indicator" [class.active]="i === currentAlerteIndex" (click)="goToAlerte(i)"></span>
            }
          </div>
        }
      </div>
    } @else {
      <div class="no-announcements">
        <p>Aucune annonce pour le moment</p>
      </div>
    }
  </div>

  <div class="summary-cards">
    @if (isLoadingDashboard) {
      <div class="summary-card courses-card">
        <div class="card-header">
          <ion-icon name="calendar"></ion-icon>
          <span class="card-label">Cours</span>
        </div>
        <div class="card-content">
          <div class="skeleton-number"></div>
          <div class="skeleton-subtitle"></div>
        </div>
      </div>
      <div class="summary-card notes-card">
        <div class="card-header">
          <ion-icon name="star"></ion-icon>
          <span class="card-label">Notes</span>
        </div>
        <div class="card-content">
          <div class="skeleton-number"></div>
          <div class="skeleton-subtitle"></div>
        </div>
      </div>
    } @else {
      <div class="summary-card courses-card">
        <div class="card-header">
          <ion-icon name="calendar"></ion-icon>
          <span class="card-label">Cours</span>
        </div>
        <div class="card-content">
          <div class="card-number">{{ nombreCoursAujourdHui }}</div>
          <div class="card-subtitle">aujourd'hui</div>
        </div>
      </div>
      <div class="summary-card notes-card">
        <div class="card-header">
          <ion-icon name="star"></ion-icon>
          <span class="card-label">Notes</span>
        </div>
        <div class="card-content">
          <div class="card-number">{{ moyenneGenerale.toFixed(1) }}</div>
          <div class="card-subtitle">moyenne</div>
        </div>
      </div>
    }
  </div>

  <!-- Schedule Section -->
  <div class="section">
    <div class="section-header">
      <h2>Emploi du temps</h2>
      <span class="see-all">Voir tout</span>
    </div>
    <div class="schedule-list">
      @if (isLoadingDashboard) {
        @for (item of [1, 2]; track item) {
          <div class="skeleton-schedule-card"></div>
        }
      } @else if (coursAujourdHui.length > 0) {
        @for (cours of coursAujourdHui; track cours.localId) {
          <div class="schedule-card" [class]="getCoursClass($index)">
            <div class="schedule-left">
              <div class="schedule-icon" [class]="getIconClass($index)">
                <ion-icon [name]="getCoursIcon(cours.matiereName)"></ion-icon>
              </div>
              <div class="schedule-info">
                <h4>{{ cours.matiereName }}</h4>
                <p>{{ cours.salleName }}</p>
              </div>
            </div>
            <div class="schedule-right">
              <div class="schedule-time" [class]="getTimeClass($index)">{{ cours.heureDebut }}</div>
              <div class="schedule-duration">{{ calculerDuree(cours.heureDebut, cours.heureFin) }}</div>
            </div>
          </div>
        }
      } @else {
        <div class="no-courses">
          <p>Aucun cours aujourd'hui</p>
        </div>
      }
    </div>
  </div>

  <!-- My Courses Section -->
  <!-- <div class="section">
    <div class="section-header">
      <h2>Mes cours</h2>
      <span class="see-all">Voir tout</span>
    </div>
    <div class="courses-grid">
      <div class="course-card">
        <div class="course-icon chemistry">
          <ion-icon name="flask"></ion-icon>
        </div>
        <h3>Chimie</h3>
        <p class="prof-name">Prof. Martin</p>
        <div class="progress-dots">
          <span class="dot active green"></span>
          <span class="dot active green"></span>
          <span class="dot"></span>
          <span class="dot"></span>
        </div>
      </div>
      <div class="course-card">
        <div class="course-icon geography">
          <ion-icon name="globe"></ion-icon>
        </div>
        <h3>Géographie</h3>
        <p class="prof-name">Prof. Dubois</p>
        <div class="progress-dots">
          <span class="dot active orange"></span>
          <span class="dot active orange"></span>
          <span class="dot"></span>
          <span class="dot"></span>
        </div>
      </div>
    </div>
  </div> -->

  <!-- Recent Notes Section -->
  <div class="section">
    <div class="section-header">
      <h2>Notes récentes</h2>
      <span class="see-all">Voir tout</span>
    </div>
    <div class="notes-list">
      @if (isLoadingNotes) {
        @for (item of [1, 2, 3]; track item) {
          <div class="skeleton-note-item"></div>
        }
      } @else if (recentNotes.length > 0) {
        @for (note of recentNotes; track note.localId) {
          <div class="note-item">
            <div class="note-icon" [class]="getNoteIconClass($index)">
              <span>{{ getNoteInitial(note.matiereName) }}</span>
            </div>
            <div class="note-content">
              <h4>{{ note.type }} - {{ note.matiereName }}</h4>
              <p>{{ formatDate(note.date) }}</p>
            </div>
            <div class="note-score" [class]="getNoteBadgeClass(note.note)">
              {{ note.note }}/20
            </div>
          </div>
        }
      } @else {
        <div class="no-notes">
          <p>Aucune note récente</p>
        </div>
      }
    </div>
  </div>

</ion-content>
